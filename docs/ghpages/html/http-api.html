<!DOCTYPE html>
<html>
<head>
  <title>Ace by DAISY Documentation: HTTP API</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<h1 id="ace-via-http">Ace via HTTP</h1>
<ul>
<li><a href="#starting-the-server">Starting the server</a></li>
<li><a href="#api">API</a><ul>
<li><a href="#job-status-codes">Job status codes</a></li>
<li><a href="#job-information">Job information</a></li>
</ul>
</li>
<li><a href="#examples">Examples</a><ul>
<li><a href="#submit-a-job">Submit a job</a></li>
<li><a href="#check-job-status">Check job status</a></li>
<li><a href="#get-the-report">Get the report</a></li>
<li><a href="#get-only-the-json-report">Get only the JSON report</a></li>
<li><a href="#list-all-the-jobs">List all the jobs</a></li>
</ul>
</li>
</ul>
<h2 id="starting-the-server">Starting the server</h2>
<p>After installing Ace, run the <code>ace-http</code> command from the terminal. There are a few options listed below.</p>
<pre><code>Ace by DAISY, an Accessibility Checker for EPUB

  Usage: ace-http [options]

  Options:

    -h, --help             output usage information
    -v, --version          output the version number

    -H, --host             set the server&#39;s hostname (default: localhost)
    -p, --port             set the server&#39;s port (default: 8000)

    -V, --verbose          display verbose output
    -s, --silent           do not display any output

  Examples
    $ ace-http -p 3000
</code></pre><h2 id="api">API</h2>
<p>This API is available to client applications.</p>
<ul>
<li><code>GET /jobs/</code>: list all the jobs</li>
<li><code>GET /job/:jobid/</code>: return information about a job</li>
<li><code>POST /jobs/</code>: attach an EPUB file to run Ace</li>
<li><code>GET /job/:jobid/report/?type=[zip|json]</code>: return a zipfile containing the report</li>
</ul>
<p>Note that failing to specify <code>type</code> of report will return the default format (which, at the moment, is <code>zip</code>)</p>
<h3 id="job-status-codes">Job status codes</h3>
<ul>
<li><code>1</code>: Processing. The job has been submitted and is being executed.</li>
<li><code>0</code>: Done. The job is done and the reports are ready.</li>
<li><code>-1</code>: Error. The job could not be completed. This is different than the file having accessibility errors. The file could not be evaluated.</li>
</ul>
<h3 id="job-information">Job information</h3>
<pre><code>  {
    job: URL for the job information
    status: A job status code
    report: {
      zip: URL for the zipped report,
      json: URL for the json report
    }
  }
</code></pre><h2 id="examples">Examples</h2>
<h3 id="submit-a-job">Submit a job</h3>
<pre><code>~ ❯❯❯ curl --form &quot;epub=@/Users/marisa/dev/epub-a11y-checker/samples/build/epub-a11y-tests-001.epub&quot; http://localhost:8000/jobs/

{&quot;job&quot;:&quot;http://localhost:8000/jobs/38fb458a-37a2-4e5c-874c-5cf387bf86c1&quot;,&quot;status&quot;:1,&quot;report&quot;:{}}%
</code></pre><h3 id="check-job-status">Check job status</h3>
<pre><code>~ ❯❯❯ curl http://localhost:8000/jobs/38fb458a-37a2-4e5c-874c-5cf387bf86c1

{&quot;job&quot;:&quot;http://localhost:8000/jobs/38fb458a-37a2-4e5c-874c-5cf387bf86c1&quot;,&quot;status&quot;:0,&quot;report&quot;:{&quot;zip&quot;:&quot;http://localhost:8000/jobs/38fb458a-37a2-4e5c-874c-5cf387bf86c1/report/?type=zip&quot;,&quot;json&quot;:&quot;http://localhost:8000/jobs/38fb458a-37a2-4e5c-874c-5cf387bf86c1/report/?type=json&quot;}}%
</code></pre><h3 id="get-the-report">Get the report</h3>
<pre><code>~ ❯❯❯ curl &#39;http://localhost:8000/jobs/38fb458a-37a2-4e5c-874c-5cf387bf86c1/report/?type=zip&#39; -o ~/out.zip

   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 47656    0 47656    0     0  1177k      0 --:--:-- --:--:-- --:--:-- 1193k

~ ❯❯❯ unzip ~/out.zip
Archive:  /Users/marisa/out.zip
  inflating: ace-report-38fb458a-37a2-4e5c-874c-5cf387bf86c1/ace.json
  inflating: ace-report-38fb458a-37a2-4e5c-874c-5cf387bf86c1/data/EPUB/images/daisy.png
  inflating: ace-report-38fb458a-37a2-4e5c-874c-5cf387bf86c1/js/ace-report-viewer.js
  inflating: ace-report-38fb458a-37a2-4e5c-874c-5cf387bf86c1/js/aceReportData.js
  inflating: ace-report-38fb458a-37a2-4e5c-874c-5cf387bf86c1/report.html
</code></pre><h3 id="get-only-the-json-report">Get only the JSON report</h3>
<pre><code>~ ❯❯❯ curl &#39;http://localhost:8000/jobs/38fb458a-37a2-4e5c-874c-5cf387bf86c1/report/?type=json&#39; -o ~/out.json
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 24972  100 24972    0     0  3482k      0 --:--:-- --:--:-- --:--:-- 4064k
~ ❯❯❯ tail ~/out.json
{&quot;@type&quot;:&quot;earl:report&quot;,&quot;@context&quot;:&quot;http://ace.daisy.org/ns/ace-report.jsonld&quot;,
...
</code></pre><h3 id="list-all-the-jobs">List all the jobs</h3>
<p>(after adding several jobs)</p>
<pre><code>~ ❯❯❯ curl http://localhost:8000/jobs/
[{&quot;job&quot;:&quot;http://localhost:8000/jobs/8198e049-2e81-4be8-b889-ace01978dabc&quot;,&quot;status&quot;:-1,&quot;report&quot;:{}},{&quot;job&quot;:&quot;http://localhost:8000/jobs/38fb458a-37a2-4e5c-874c-5cf387bf86c1&quot;,&quot;status&quot;:0,&quot;report&quot;:{&quot;zip&quot;:&quot;http://localhost:8000/jobs/38fb458a-37a2-4e5c-874c-5cf387bf86c1/report/?type=zip&quot;,&quot;json&quot;:&quot;http://localhost:8000/jobs/38fb458a-37a2-4e5c-874c-5cf387bf86c1/report/?type=json&quot;}},{&quot;job&quot;:&quot;http://localhost:8000/jobs/107df1e7-deff-436f-811e-2a8473b20237&quot;,&quot;status&quot;:0,&quot;report&quot;:{&quot;zip&quot;:&quot;http://localhost:8000/jobs/107df1e7-deff-436f-811e-2a8473b20237/report/?type=zip&quot;,&quot;json&quot;:&quot;http://localhost:8000/jobs/107df1e7-deff-436f-811e-2a8473b20237/report/?type=json&quot;}},{&quot;job&quot;:&quot;http://localhost:8000/jobs/d62bb7c7-4eea-4f0b-bd73-b45f28630ebe&quot;,&quot;status&quot;:0,&quot;report&quot;:{&quot;zip&quot;:&quot;http://localhost:8000/jobs/d62bb7c7-4eea-4f0b-bd73-b45f28630ebe/report/?type=zip&quot;,&quot;json&quot;:&quot;http://localhost:8000/jobs/d62bb7c7-4eea-4f0b-bd73-b45f28630ebe/report/?type=json&quot;}},{&quot;job&quot;:&quot;http://localhost:8000/jobs/4363a917-c422-486f-98c0-bd98cc423fc0&quot;,&quot;status&quot;:0,&quot;report&quot;:{&quot;zip&quot;:&quot;http://localhost:8000/jobs/4363a917-c422-486f-98c0-bd98cc423fc0/report/?type=zip&quot;,&quot;json&quot;:&quot;http://localhost:8000/jobs/4363a917-c422-486f-98c0-bd98cc423fc0/report/?type=json&quot;}}]%
</code></pre></body>
</html>
